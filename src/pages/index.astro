---
import { defaultLang, supportedLanguages } from '../i18n/config';

// Get browser language
const browserLang = Astro.request.headers.get('accept-language')?.split(',')[0].split('-')[0];

// Check if browser language is supported, otherwise use default
const targetLang = browserLang && Object.keys(supportedLanguages).includes(browserLang) 
  ? browserLang 
  : defaultLang;

// Perform redirect with 307 status for language detection
return new Response("", {
  status: 307,
  headers: {
    "Location": `/${targetLang}`,
    "Cache-Control": "no-cache, no-store, must-revalidate",
    "Pragma": "no-cache",
    "Expires": "0"
  }
});
---